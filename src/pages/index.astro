---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import KeyVisual from '../components/KeyVisual.astro';
import ArticleGrid from '../components/ArticleGrid.astro';
import FeaturedPostsSlider from '../components/FeaturedPostsSlider.astro';

const posts = await getCollection('blog');
---

<BaseLayout title="Gira's Blog">
  <KeyVisual />

  <section class="featured-section fade-in">
    <h2 class="featured-title">Topics</h2>
    <FeaturedPostsSlider posts={posts.slice(0, 5)} />
  </section>

  <section class="blog-section fade-in">
    <h2 class="featured-title">Journal</h2>
    <ArticleGrid posts={posts} />
  </section>

  <script is:inline>
    window.addEventListener('load', () => {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, {
        threshold: 0.1,
      });

      document.querySelectorAll('.fade-in').forEach(el => {
        observer.observe(el);
      });
    });
  </script>

  <style>
    .featured-section {
      background-color: #f0efef;
      padding: 1rem 2rem 3rem;
      text-align: center;
    }

    .featured-title {
      font-size: 2.2rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
      text-align: center;
      color: #000;
      font-family: 'Zen Kaku Gothic New', sans-serif;
    }

    .blog-section {
      margin-top: 4rem;
      padding: 0 1rem;
    }

    .blog-section h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: #1e3932;
    }

    .fade-in {
      opacity: 0;
      transform: translateY(40px);
      transition: all 1.2s ease-out;
    }

    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* ↓↓↓ モバイル対応（768px以下） ↓↓↓ */
    @media (max-width: 768px) {
      .featured-section {
        padding: 1rem;
      }

      .featured-title {
        font-size: 1.6rem;
      }

      .blog-section {
        padding: 0 1rem;
      }

      .blog-section h2 {
        font-size: 1.4rem;
        text-align: center;
      }
    }
  </style>
</BaseLayout>
