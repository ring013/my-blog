---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const posts = await getCollection('blog');
---

<BaseLayout title="Journal">
  <section class="blog-hero">
    <img src="/images/blog-hero.jpg" alt="海と空のふんわりヒーロー画像" />
    <div class="overlay">
      <h1>Journal</h1>
    </div>
  </section>

  <section class="blog-posts">
    <div class="post-grid">
      {posts.map((post) => (
        <article class="post-card fade-in">
          <a href={`/blog/${post.slug}`}>
            <div class="post-image">
              <img src={post.data.image || '/images/img-test.png'} alt={post.data.title} />
            </div>
            <div class="post-content">
              <h2>{post.data.title}</h2>
              <p>{post.data.description}</p>
            </div>
          </a>
        </article>
      ))}
    </div>
  </section>

  <script is:inline>
    window.addEventListener('load', () => {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, {
        threshold: 0.1,
      });

      document.querySelectorAll('.fade-in').forEach(el => {
        observer.observe(el);
      });
    });
  </script>

  <style>
    .blog-hero {
      position: relative;
      width: 100%;
      height: 250px;
      overflow: hidden;
      border-radius: 1rem;
      margin-bottom: 6rem;
    }

    .blog-hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.95) blur(1px);
      opacity: 0.6;
    }

    .blog-hero .overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      text-align: center;
      text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.4);
    }

    .blog-hero .overlay h1 {
      font-size: 2.5rem;
      margin: 0;
      letter-spacing: 1px;
    }

    .blog-posts {
      display: flex;
      justify-content: center;
      padding: 2rem 1rem 4rem;
    }

    .post-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 3rem;
      max-width: 880px;
      width: 100%;
      justify-items: center;
    }

    .post-card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 1.2s ease-out, transform 0.3s ease-out;
      opacity: 0;
      transform: translateY(40px);
    }

    .post-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .post-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .post-card a {
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .post-image {
      width: 100%;
      aspect-ratio: 16 / 9;
      overflow: hidden;
    }

    .post-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .post-content {
      padding: 1rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .post-content h2 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .post-content p {
      font-size: 0.9rem;
      color: #555;
      margin: 0;
    }
    
    @media (max-width: 768px) {
      .post-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</BaseLayout>
